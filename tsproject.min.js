"use strict";var __extends=(this&&this.__extends)||(function(){var extendStatics=Object.setPrototypeOf||({__proto__:[]} instanceof Array&&function(d,b){d.__proto__=b;})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];};return function(d,b){extendStatics(d,b);function __(){this.constructor=d;}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __());};})();Object.defineProperty(exports,"__esModule",{value:true});var a=require("typescript");var b=require("chalk");var c=require("fs");var d=require("chokidar");var h=require("path");var k=require("stream");var File=require("vinyl");var _=require("lodash");var l=require("glob");var m={none:0,error:1,warn:2,trace:3,info:4};var n=(function(){function n(){}n.j=function(a){this.f=a;};n.l=function(a){this.g=a;};n.p=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i]=arguments[_i];}console.log.apply(console,[b.gray("["+this.g+"]")].concat(d));};n.r=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i]=arguments[_i];}if(this.f<m.info){return;}console.log.apply(console,[b.gray("["+this.g+"]"+b.blue(" INFO: "))].concat(d));};n.u=function(){var d=[];for(var _i=0;_i<arguments.length;_i++){d[_i]=arguments[_i];}if(this.f<m.warn){return;}console.log.apply(console,["["+this.g+"]"+b.yellow(" WARNING: ")].concat(d));};n.v=function(){var c=[];for(var _i=0;_i<arguments.length;_i++){c[_i]=arguments[_i];}if(this.f<m.error){return;}console.log.apply(console,["["+this.g+"]"+b.red(" ERROR: ")].concat(c));};n.x=function(){var c=[];for(var _i=0;_i<arguments.length;_i++){c[_i]=arguments[_i];}if(this.f<m.error){return;}console.log.apply(console,["["+this.g+"]"+b.gray(" TRACE: ")].concat(c));};return n;}());n.f=m.none;n.g="logger";var TsCore;(function(TsCore){function b(c,d){var e=c.length;var g=d.length;return e>g&&c.substr(e-g,g)===d;}TsCore.b=b;TsCore.f=[".ts",".tsx",".d.ts"];TsCore.g=TsCore.f;function i(a){if(!a){return false;}for(var _i=0,f_1=TsCore.f;_i<f_1.length;_i++){var c=f_1[_i];if(b(a,c)){return true;}}return false;}TsCore.i=i;function j(d){var f=d.getDeclarations();if(f&&f.length>0){if(f[0].kind===a.SyntaxKind.SourceFile){return f[0].getSourceFile();}}return undefined;}TsCore.j=j;function k(b){if(b.kind===a.SyntaxKind.ImportDeclaration){return b.moduleSpecifier;}if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var c=b.moduleReference;if(c.kind===a.SyntaxKind.ExternalModuleReference){return c.expression;}}if(b.kind===a.SyntaxKind.ExportDeclaration){return b.moduleSpecifier;}return undefined;}TsCore.k=k;function l(f){var g=[];for(var _i=1;_i<arguments.length;_i++){g[_i-1]=arguments[_i];}var k=f.message;if(arguments.length>1){k=m(k,arguments,1);}return {file:undefined,start:undefined,length:undefined,messageText:k,category:f.category,code:f.code};}TsCore.l=l;function m(a,b,c){c=c||0;return a.replace(/{(\d+)}/g,function(d,a){return b[+a+c];});}function q(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration||b.kind===a.SyntaxKind.ImportClause&&!!b.name||b.kind===a.SyntaxKind.NamespaceImport||b.kind===a.SyntaxKind.ImportSpecifier||b.kind===a.SyntaxKind.ExportSpecifier||b.kind===a.SyntaxKind.ExportAssignment&&b.expression.kind===a.SyntaxKind.Identifier;}TsCore.q=q;function v(b){return b.replace(/\\/g,"/");}TsCore.v=v;function y(a){return a.replace(/\.ts/,".js");}TsCore.y=y;})(TsCore||(TsCore={}));var Utils;(function(Utils){function d(c,e){if(c){for(var i=0,f=c.length;i<f;i++){var g=e(c[i],i);if(g){return g;}}}return undefined;}Utils.d=d;function g(a,b){if(a){for(var _i=0,a_1=a;_i<a_1.length;_i++){var v=a_1[_i];if(v===b){return true;}}}return false;}Utils.g=g;var k=Object.prototype.hasOwnProperty;function m(b,c){return k.call(b,c);}Utils.m=m;function q(a){var b={};for(var c in a){b[c]=a[c];}return b;}Utils.q=q;function z(b,f){var c;if(b){c=[];for(var _i=0,b_1=b;_i<b_1.length;_i++){var v=b_1[_i];c.push(f(v));}}return c;}Utils.z=z;function F(b,d){var f=1;var g={};for(var h in b){g[h]=b[h];}for(var i in d){if(!m(g,i)){g[i]=d[i];}}return g;}Utils.F=F;function G(b,c,d){return b.substr(0,c)+d+b.substr(c+d.length);}Utils.G=G;})(Utils||(Utils={}));var o=(function(){function o(b,d){this.c=b;this.e=d;}o.prototype.f=function(){return this.e;};o.prototype.g=function(){return this.c;};o.prototype.k=function(){return (this.c===a.ExitStatus.Success);};return o;}());var p=(function(){function p(b){var _this=this;this.b={};this.c={};this.e=0;this.f={};this.g=0;this.i={};this.getSourceFile=this.v;this.fileExists=function(b){b=_this.getCanonicalFileName(b);if(!_this.directoryExists(h.dirname(b))){return false;}if(Utils.m(_this.f,b)){return _this.f[b];}_this.g++;return _this.f[b]=_this.l.fileExists(b);};this.j=b;this.l=a.createCompilerHost(this.j);}p.prototype.s=function(){return this.b;};p.prototype.v=function(k,o,p){return this.l.getSourceFile(k,o,p);};p.prototype.writeFile=function(c,e,f,g){this.b[c]=e;};p.prototype.readFile=function(a){if(Utils.m(this.i,a)){n.x("readFile() cache hit: ",a);return this.i[a];}n.x("readFile() Adding to cache: ",a);return this.i[a]=this.l.readFile(a);};p.prototype.getDefaultLibFileName=function(b){return this.l.getDefaultLibFileName(b);};p.prototype.getCurrentDirectory=function(){return this.l.getCurrentDirectory();};p.prototype.getDirectories=function(a){return this.l.getDirectories(a);};p.prototype.getCanonicalFileName=function(b){return this.l.getCanonicalFileName(b);};p.prototype.useCaseSensitiveFileNames=function(){return this.l.useCaseSensitiveFileNames();};p.prototype.getNewLine=function(){return this.l.getNewLine();};p.prototype.directoryExists=function(b){if(Utils.m(this.c,b)){return this.c[b];}this.e++;return this.c[b]=a.sys.directoryExists(b);};return p;}());var q=(function(_super){__extends(q,_super);function q(a){return _super.call(this,{objectMode:true})||this;}q.prototype._read=function(){};return q;}(k.Readable));var r=(function(){function r(){}r.prototype.a=function(b){n.p(b);};r.prototype.c=function(d,e){n.p(this.h(d+":",25)+b.magenta(this.g(e.toString(),10)));};r.prototype.d=function(a,b){this.c(a,""+b);};r.prototype.e=function(b,g){this.c(b,(g/1000).toFixed(2)+"s");};r.prototype.f=function(a,b){this.c(a,b.toFixed(2)+"%");};r.prototype.g=function(s,a){while(s.length<a){s=" "+s;}return s;};r.prototype.h=function(s,a){while(s.length<a){s=s+" ";}return s;};return r;}());var t=(function(_super){__extends(t,_super);function t(a){return _super.call(this,a)||this;}return t;}(File));var BundlePackageType;(function(BundlePackageType){BundlePackageType[BundlePackageType["None"]=0]="None";BundlePackageType[BundlePackageType["Library"]=1]="Library";BundlePackageType[BundlePackageType["Component"]=2]="Component";})(BundlePackageType||(BundlePackageType={}));var u=(function(){function u(a,d){this.c=undefined;this.b=a;this.c=d;}u.prototype.d=function(){return this.b;};u.prototype.e=function(){return this.c;};return u;}());var w=(function(){function w(){}w.prototype.b=function(d,f){var g=[];return {bundles:b(),errors:g};function b(){var c=[];var e=d["bundles"];if(e){n.r(e);for(var i in e){n.r("Bundle Id: ",i,e[i]);var k=e[i];var q;var x=[];var y={};q=h.join(f,i);if(Utils.m(k,"files")){if(k["files"] instanceof Array){x=Utils.z(k["files"],function(s){return h.join(f,s);});n.r("bundle files: ",x);}else{g.push(TsCore.l({code:6063,category:a.DiagnosticCategory.Error,key:"Bundle_0_files_is_not_an_array_6063",message:"Bundle '{0}' files is not an array."},i));}}else{g.push(TsCore.l({code:6062,category:a.DiagnosticCategory.Error,key:"Bundle_0_requires_an_array_of_files_6062",message:"Bundle '{0}' requires an array of files."},i));}if(Utils.m(k,"config")){y=k.config;}y.package=A(y);c.push({name:q,fileNames:x,config:y});}}return c;}function A(b){var c=0;var d=undefined;var e={"none":0,"library":1,"component":2};if(Utils.m(b,"package")){var f=b["package"];if(typeof (f)==="string"){if(Utils.m(e,f.toLowerCase())){c=e[f.toLowerCase()];}}}if(Utils.m(b,"packageNamespace")){var g=b["packageNamespace"];if(typeof (g)==="string"){d=g;}}return new u(c,d);}};return w;}());var y=(function(){function y(b,f,g){this.K=0;this.N=0;this.O=0;this.c=b;this.w=f;this.A=g;this.F=this.w.getCompilerOptions();}y.prototype.P=function(q){this.O=this.K=new Date().getTime();n.p("Compiling project files...");var u=a.getPreEmitDiagnostics(this.w);if(this.F.noEmitOnError&&u.length>0){return new o(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,u);}this.K=new Date().getTime()-this.K;if(!this.F.noEmit){var y=new Date().getTime();var z=this.w.emit();this.N=new Date().getTime()-y;u=u.concat(z.diagnostics);if(z.emitSkipped){return new o(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,u);}var B=this.c.s();for(var C in B){var D=B[C];var E=new t({path:C,contents:new Buffer(D)});this.A.push(E);}}this.O=new Date().getTime()-this.O;if(u.length>0){return new o(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,u);}if(this.F.diagnostics){this.Q();}return new o(a.ExitStatus.Success);};y.prototype.Q=function(){var c=new r();c.d("Files",this.w.getSourceFiles().length);c.d("Lines",this.R());c.e("Pre-emit time",this.K);c.e("Emit time",this.N);c.e("Compile time",this.O);};y.prototype.R=function(){var _this=this;var a=0;Utils.d(this.w.getSourceFiles(),function(b){if(!b.isDeclarationFile){a+=_this.S(b).length;}});return a;};y.prototype.S=function(b){return b.getLineStarts();};return y;}());var z=(function(_super){__extends(z,_super);function z(b,c){var _this=_super.call(this,b)||this;_this.getSourceFile=function(b,c,e){if(_this.u){var g_1=_this.u.getSourceFile(b);if(g_1&&g_1.fileWatcher){n.x("getSourceFile() watcher hit for: ",b);return g_1;}}n.x("getSourceFile() reading source file from fs: ",b);var f=_super.prototype.v.call(_this,b,c,e);if(f&&_this.j.watch){f.fileWatcher=d.watch(f.fileName);f.fileWatcher.on("change",function(a,b){return _this.w(f,a,b);});}return f;};_this.w=c;return _this;}z.prototype.y=function(b){this.u=b;};return z;}(p));var Ast;(function(Ast){function b(f){var g=a.ModifierFlags.None;if(f.modifiers){for(var _i=0,_a=f.modifiers;_i<_a.length;_i++){var h=_a[_i];g|=c(h.kind);}}return g;}Ast.b=b;function c(b){switch(b){case a.SyntaxKind.StaticKeyword:return a.ModifierFlags.Static;case a.SyntaxKind.PublicKeyword:return a.ModifierFlags.Public;case a.SyntaxKind.ProtectedKeyword:return a.ModifierFlags.Protected;case a.SyntaxKind.PrivateKeyword:return a.ModifierFlags.Private;case a.SyntaxKind.AbstractKeyword:return a.ModifierFlags.Abstract;case a.SyntaxKind.ExportKeyword:return a.ModifierFlags.Export;case a.SyntaxKind.DeclareKeyword:return a.ModifierFlags.Ambient;case a.SyntaxKind.ConstKeyword:return a.ModifierFlags.Const;case a.SyntaxKind.DefaultKeyword:return a.ModifierFlags.Default;case a.SyntaxKind.AsyncKeyword:return a.ModifierFlags.Async;case a.SyntaxKind.ReadonlyKeyword:return a.ModifierFlags.Readonly;}return a.ModifierFlags.None;}Ast.c=c;var ContainerFlags;(function(ContainerFlags){ContainerFlags[ContainerFlags["None"]=0]="None";ContainerFlags[ContainerFlags["IsContainer"]=1]="IsContainer";ContainerFlags[ContainerFlags["IsBlockScopedContainer"]=2]="IsBlockScopedContainer";ContainerFlags[ContainerFlags["IsControlFlowContainer"]=4]="IsControlFlowContainer";ContainerFlags[ContainerFlags["IsFunctionLike"]=8]="IsFunctionLike";ContainerFlags[ContainerFlags["IsFunctionExpression"]=16]="IsFunctionExpression";ContainerFlags[ContainerFlags["HasLocals"]=32]="HasLocals";ContainerFlags[ContainerFlags["IsInterface"]=64]="IsInterface";ContainerFlags[ContainerFlags["IsObjectLiteralOrClassExpressionMethod"]=128]="IsObjectLiteralOrClassExpressionMethod";ContainerFlags[ContainerFlags["IsContainerWithLocals"]=33]="IsContainerWithLocals";})(ContainerFlags=Ast.ContainerFlags||(Ast.ContainerFlags={}));function f(b){if(b.kind!==a.SyntaxKind.BinaryExpression){return false;}var c=b;if(c.operatorToken.kind!==a.SyntaxKind.EqualsToken||c.left.kind!==a.SyntaxKind.PropertyAccessExpression){return false;}var d=c.left;if(d.expression.kind===a.SyntaxKind.PropertyAccessExpression){var e=d.expression;if(e.expression.kind===a.SyntaxKind.Identifier&&e.name.text==="prototype"){return true;}}return false;}Ast.f=f;function g(b){if(b){switch(b.kind){case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.ArrowFunction:case a.SyntaxKind.MethodDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return true;}}return false;}Ast.g=g;function h(c){return c.kind===a.SyntaxKind.MethodDeclaration&&(c.parent.kind===a.SyntaxKind.ObjectLiteralExpression||c.parent.kind===a.SyntaxKind.ClassExpression);}Ast.h=h;function l(c){if(c&&(c.flags&a.SymbolFlags.Interface)){if(c.valueDeclaration){var d=b(c.valueDeclaration);return false;}}return false;}Ast.l=l;function o(c){if(c&&(c.flags&a.SymbolFlags.Class)){var d=b(c.valueDeclaration);if(!(d&a.ModifierFlags.Export)){return true;}}return false;}Ast.o=o;function p(c){if(c&&c.valueDeclaration){if(b(c.valueDeclaration)&a.ModifierFlags.Abstract){return true;}}return false;}Ast.p=p;function q(c,g){var h=[];function f(c,d){var e=c.types;if(e){for(var _i=0,e_1=e;_i<e_1.length;_i++){var g=e_1[_i];var i=d.getTypeAtLocation(g);var j=i.symbol.valueDeclaration;if(j){var l=j.heritageClauses;if(l){for(var _a=0,l_1=l;_a<l_1.length;_a++){var m=l_1[_a];f(m,d);}}}var k=i.getProperties();for(var _b=0,k_1=k;_b<k_1.length;_b++){var n=k_1[_b];if(Ast.G(n)){h.push(n);}}}}}var k=c.heritageClauses;if(k){for(var _i=0,k_2=k;_i<k_2.length;_i++){var o=k_2[_i];f(o,g);}}return h;}Ast.q=q;function s(c,d){var e=[];var f=c.types;for(var _i=0,f_2=f;_i<f_2.length;_i++){var g=f_2[_i];var h=d.getTypeAtLocation(g);var i=h.getSymbol();if(i.valueDeclaration){if(b(i.valueDeclaration)&a.ModifierFlags.Abstract){var j=h.getProperties();for(var _a=0,j_1=j;_a<j_1.length;_a++){var k=j_1[_a];e.push(k);}}}}return e;}Ast.s=s;function t(b,c){var d=[];var e=b.types;for(var _i=0,e_2=e;_i<e_2.length;_i++){var f=e_2[_i];var g=c.getTypeAtLocation(f);var h=g.getProperties();for(var _a=0,h_1=h;_a<h_1.length;_a++){var i=h_1[_a];d.push(i);}}return d;}Ast.t=t;function v(b){if(!b){return undefined;}var c=b.id;if(c===undefined&&b.valueDeclaration){c=b.valueDeclaration.symbol.id;}return c?c.toString():undefined;}Ast.v=v;function w(b){switch(b.kind){case a.SyntaxKind.ClassExpression:case a.SyntaxKind.ClassDeclaration:case a.SyntaxKind.EnumDeclaration:case a.SyntaxKind.ObjectLiteralExpression:case a.SyntaxKind.TypeLiteral:case a.SyntaxKind.JSDocTypeLiteral:case a.SyntaxKind.JSDocRecordType:return 1;case a.SyntaxKind.InterfaceDeclaration:return 1|64;case a.SyntaxKind.JSDocFunctionType:case a.SyntaxKind.ModuleDeclaration:case a.SyntaxKind.TypeAliasDeclaration:return 1|32;case a.SyntaxKind.SourceFile:return 1|4|32;case a.SyntaxKind.MethodDeclaration:if(h(b)){return 1|4|32|8|128;}case a.SyntaxKind.Constructor:case a.SyntaxKind.FunctionDeclaration:case a.SyntaxKind.MethodSignature:case a.SyntaxKind.GetAccessor:case a.SyntaxKind.SetAccessor:case a.SyntaxKind.CallSignature:case a.SyntaxKind.ConstructSignature:case a.SyntaxKind.IndexSignature:case a.SyntaxKind.FunctionType:case a.SyntaxKind.ConstructorType:return 1|4|32|8;case a.SyntaxKind.FunctionExpression:case a.SyntaxKind.ArrowFunction:return 1|4|32|8|16;case a.SyntaxKind.ModuleBlock:return 4;case a.SyntaxKind.PropertyDeclaration:return b.initializer?4:0;case a.SyntaxKind.CatchClause:case a.SyntaxKind.ForStatement:case a.SyntaxKind.ForInStatement:case a.SyntaxKind.ForOfStatement:case a.SyntaxKind.CaseBlock:return 2;case a.SyntaxKind.Block:return g(b.parent)?0:2;}return 0;}Ast.w=w;function y(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_1=c;_i<c_1.length;_i++){var d=c_1[_i];if(d.token===a.SyntaxKind.ImplementsKeyword){return d;}}}}return undefined;}Ast.y=y;function z(b){if(b){var c=b.heritageClauses;if(c){for(var _i=0,c_2=c;_i<c_2.length;_i++){var d=c_2[_i];if(d.token===a.SyntaxKind.ExtendsKeyword){return d;}}}}return undefined;}Ast.z=z;function A(b){return a.SyntaxKind.FirstKeyword<=b&&b<=a.SyntaxKind.LastKeyword;}Ast.A=A;function B(b){return a.SyntaxKind.FirstPunctuation<=b&&b<=a.SyntaxKind.LastPunctuation;}Ast.B=B;function C(b){return a.SyntaxKind.FirstTriviaToken<=b&&b<=a.SyntaxKind.LastTriviaToken;}Ast.C=C;function G(b){var c=b.valueDeclaration;while(c){if(c.flags&a.NodeFlags.ExportContext){return true;}c=c.parent;}return false;}Ast.G=G;function H(c){var d=c.valueDeclaration;while(d){if(b(d)&a.ModifierFlags.Ambient){return true;}d=d.parent;}return false;}Ast.H=H;function I(c){return (c.kind===a.SyntaxKind.SourceFile&&!c.isDeclarationFile);}Ast.I=I;})(Ast||(Ast={}));var A=(function(){function A(){}A.prototype.a=function(b){var g=new l.Glob(b);var c=g.minimatch.set ;if(c.length>1)return true;for(var j=0;j<c[0].length;j++){if(typeof c[0][j]!=='string')return true;}return false;};A.prototype.b=function(e,f){if(e.length===0){return [];}var g=this.c(e,function(a){return l.sync(a,{root:f});});return g;};A.prototype.c=function(f,g){var i=[];_.flatten(f).forEach(function(b){var c;var a;c=_.isString(b)&&b.indexOf("!")===0;if(c){b=b.slice(1);}a=g(b);if(c){return i=_.difference(i,a);}else{return i=_.union(i,a);}});return i;};return A;}());var B=(function(){function B(b,d,e){this.c=b;this.o=d;this.q=e;}B.prototype.s=function(){return this.q;};B.prototype.t=function(){return this.o;};B.prototype.u=function(){return this.c;};B.prototype.w=function(){return (this.c===a.ExitStatus.Success);};return B;}());var C=(function(){function C(b,d){this.i={};this.c=b;this.f=d;this.g=this.f.getCompilerOptions();}C.prototype.o=function(b){var f=this;var g={};var i={};function d(b){b.forEach(function(b){var e=f.t(b);var h=f.w(e);var j=f.c.getCanonicalFileName(h.fileName);if(!Utils.m(i,j)){i[j]=true;if(!h.isDeclarationFile){n.r("Walking Import module: ",j);d(f.p(h));}}if(!Utils.m(g,j)){n.r("Getting and adding imports of module file: ",j);g[j]=f.p(h);}});}var k=f.p(b);d(k);var q=f.c.getCanonicalFileName(b.fileName);if(!Utils.m(g,q)){n.r("Adding top level import dependencies for file: ",q);g[q]=k;}return g;};C.prototype.p=function(c){if(!Ast.I(c)){return [];}var d=[];var e=this;function h(g){a.forEachChild(g,function(g){if(g.kind===a.SyntaxKind.ImportDeclaration||g.kind===a.SyntaxKind.ImportEqualsDeclaration||g.kind===a.SyntaxKind.ExportDeclaration){var i=TsCore.k(g);if(i&&i.kind===a.SyntaxKind.StringLiteral){var j=e.f.getTypeChecker().getSymbolAtLocation(i);if(j){n.r("Adding import node: ",j.name);d.push(g);}else{n.u("Module symbol not found");}}}else if(g.kind===a.SyntaxKind.ModuleDeclaration){var l=g;if((l.name.kind===a.SyntaxKind.StringLiteral)&&(Ast.b(l)&a.ModifierFlags.Ambient||c.isDeclarationFile)){n.r("Scanning for dependencies within ambient module declaration: ",l.name.text);h(l.body);}}});};n.r("Getting imports for source file: ",c.fileName);h(c);return d;};C.prototype.q=function(b){return b.kind===a.SyntaxKind.ImportEqualsDeclaration&&b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference;};C.prototype.s=function(b){return b.moduleReference.expression;};C.prototype.t=function(b){var c=TsCore.k(b);if(c&&c.kind===a.SyntaxKind.StringLiteral){return this.f.getTypeChecker().getSymbolAtLocation(c);}};C.prototype.w=function(b){var c=b.getDeclarations()[0];return c.getSourceFile();};return C;}());var D=(function(){function D(b,d,e){this.h={};this.k=[];this.A=undefined;this.c=b;this.g=d;this.k=[b];this.h[e.f().toString()]=e;}D.prototype.B=function(){return this.g;};D.prototype.I=function(){return this.g.name;};D.prototype.J=function(){var b=this.g.id;if(b===undefined&&this.g.valueDeclaration){b=this.g.valueDeclaration.symbol.id;}return b?b.toString():undefined;};D.prototype.K=function(){return this.h;};D.prototype.L=function(){return this.k;};D.prototype.M=function(b,c){this.k.push(b);if(!Utils.m(this.h,c.f().toString())){this.h[c.f().toString()]=c;}};D.prototype.N=function(){if((this.g.flags&a.SymbolFlags.Alias)>0){if(this.g.declarations[0].kind===a.SyntaxKind.NamespaceImport){return true;}}return false;};D.prototype.O=function(){if((this.g.flags&a.SymbolFlags.FunctionScopedVariable)>0){var b=this.W();if(b){return true;}}return false;};D.prototype.P=function(){if((this.g.flags&a.SymbolFlags.BlockScopedVariable)>0){var b=this.W();if(b){return ((b.parent.flags&a.NodeFlags.Let)!==0)||((b.parent.flags&a.NodeFlags.Const)!==0);}}return false;};D.prototype.Q=function(){if((this.g.flags&a.SymbolFlags.FunctionScopedVariable)>0){if(this.g.valueDeclaration.kind===a.SyntaxKind.Parameter){return true;}}return false;};D.prototype.R=function(){return Ast.o(this.g);};D.prototype.S=function(){return Ast.l(this.g);};D.prototype.T=function(c){if(this.g.flags&a.SymbolFlags.Function){if(this.g.valueDeclaration.kind===a.SyntaxKind.FunctionDeclaration){var d=Ast.b(this.g.valueDeclaration);if(Ast.G(this.g)||Ast.H(this.g)){return false;}if(!(d&a.ModifierFlags.Export)){return true;}if(c){var e=this.g.valueDeclaration;while(e){if(e.flags&a.NodeFlags.Namespace){var f=e.name.text;if(f!==c){return true;}}e=e.parent;}}}}return false;};D.prototype.U=function(){if((this.g.flags&a.SymbolFlags.Method)>0){if(this.g.valueDeclaration===undefined){return false;}var c=Ast.b(this.g.valueDeclaration);if((c&a.ModifierFlags.Private)>0){return true;}var d_1=this.g.parent;if(d_1&&Ast.o(d_1)){if(!Ast.p(d_1)){return true;}}if(d_1&&Ast.l(d_1)){return false;}}return false;};D.prototype.V=function(){if((this.g.flags&a.SymbolFlags.Property)>0){if(this.g.valueDeclaration===undefined){return false;}var c=Ast.b(this.g.valueDeclaration);if((c&a.ModifierFlags.Private)>0){return true;}var d_2=this.g.parent;if(d_2&&Ast.o(d_2)){if(!Ast.p(d_2)){return true;}}}return false;};D.prototype.W=function(){switch(this.c.parent.kind){case a.SyntaxKind.VariableDeclaration:return this.c.parent;case a.SyntaxKind.VariableDeclarationList:n.u("VariableDeclaratioList in getVariableDeclaration() - returning null");break;case a.SyntaxKind.VariableStatement:n.u("VariableStatement in getVariableDeclaration() - returning null");break;}return null;};return D;}());var F=(function(){function F(){}F.c=function(){return this.b++;};return F;}());F.b=1;var E=(function(){function E(d,f,i){this.l=[];this.p=undefined;this.G={};this.H={};this.N={};this.O={};this.Q=[];this.R=0;this.b=F.c();this.h=f;if(f&2){this.g=d;this.o=true;this.k=i.U();}else{this.e=this.g=d;this.o=false;this.k=this;}this.C=0;}E.prototype.f=function(){return this.b;};E.prototype.S=function(b){this.l.push(b);};E.prototype.T=function(){return this.l;};E.prototype.U=function(){return this.k;};E.prototype.V=function(){if(this.o){return this.k.V();}return this.C++;};E.prototype.W=function(){return this.o?this.g:this.e;};E.prototype.X=function(){if(this.e){switch(this.e.kind){case a.SyntaxKind.ClassDeclaration:return this.e.members;case a.SyntaxKind.EnumDeclaration:return this.e.members;default:n.x("Container::getMembers() unprocessed container kind: ",this.e.kind,this.f());}}return undefined;};E.prototype.Y=function(){if(this.e&&this.h&32){switch(this.e.kind){case a.SyntaxKind.ModuleDeclaration:return this.e.locals;default:n.u("Container::getLocals() unprocessed container kind: ",this.e.kind,this.f());}}return undefined;};E.prototype.Z=function(){return this.o;};E.prototype.$=function(){if(this.h&(1|33)){return true;}return false;};E.prototype._=function(b){if(b.flags&a.SymbolFlags.Class){this.p=b;}};E.prototype.ab=function(){return this.p;};E.prototype.bb=function(a){for(var i=0;i<this.l.length;i++){if(a.f()===this.l[i].f())return true;}return false;};return E;}());var G=(function(){function G(){}G.prototype.walk=function(b){this.visitNode(b);};G.prototype.visitNode=function(b){this.walkChildren(b);};G.prototype.walkChildren=function(b){var _this=this;a.forEachChild(b,function(a){return _this.visitNode(a);});};return G;}());var H=(function(){function H(){this.b="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_0123456789";}H.prototype.c=function(a){var b=["do","if","in","for","int","let","new","try","var"];var d;while(true){d=this.g(a++);if(b.indexOf(d)>0){continue;}else{return d;}}};H.prototype.g=function(a){var c=a;var d=this.b[c%54];c=Math.floor(c/54);while(c>0){d+=this.b[c%64];c=Math.floor(c/64);}return d;};return H;}());var Debug;(function(Debug){function a(b,d){if(!b){d=d||"Assertion failed";if(typeof Error!=="undefined"){throw new Error(d);}throw d;}}Debug.a=a;})(Debug||(Debug={}));var I=(function(_super){__extends(I,_super);function I(b,c,d){var _this=_super.call(this)||this;_this.Z=[];_this.$={};_this.bb={};_this.ib=0;_this.jb=0;_this.g=b;_this.k=b.getTypeChecker();_this.l=c;_this.F=d;_this.Z=[];_this.db=new H();return _this;}I.prototype.transform=function(c){this.b=c;return this.mb(c);};I.prototype.kb=function(b){this.gb=new Date().getTime();this.eb=b.length;var c="";var g=a.SyntaxKind.Unknown;var k=false;var q;var s=a.createScanner(a.ScriptTarget.ES5,false,a.LanguageVariant.Standard,b);while((q=s.scan())!==a.SyntaxKind.EndOfFileToken){k=false;if(Ast.C(q)){k=true;}if(!k){switch(g){case a.SyntaxKind.FunctionKeyword:if(q===a.SyntaxKind.Identifier){c+=" ";}break;case a.SyntaxKind.BreakKeyword:case a.SyntaxKind.ContinueKeyword:case a.SyntaxKind.ReturnKeyword:case a.SyntaxKind.YieldKeyword:if(q!==a.SyntaxKind.SemicolonToken){c+=" ";}break;case a.SyntaxKind.ElseKeyword:if(q!==a.SyntaxKind.OpenBraceToken){c+=" ";}break;}switch(q){case a.SyntaxKind.CaseKeyword:case a.SyntaxKind.ClassKeyword:case a.SyntaxKind.ConstKeyword:case a.SyntaxKind.DeleteKeyword:case a.SyntaxKind.DoKeyword:case a.SyntaxKind.ExportKeyword:case a.SyntaxKind.GetKeyword:case a.SyntaxKind.ImportKeyword:case a.SyntaxKind.LetKeyword:case a.SyntaxKind.NewKeyword:case a.SyntaxKind.SetKeyword:case a.SyntaxKind.StaticKeyword:case a.SyntaxKind.ThrowKeyword:case a.SyntaxKind.TypeOfKeyword:case a.SyntaxKind.VarKeyword:case a.SyntaxKind.VoidKeyword:c+=s.getTokenText()+" ";break;case a.SyntaxKind.ExtendsKeyword:case a.SyntaxKind.InKeyword:case a.SyntaxKind.InstanceOfKeyword:c+=" "+s.getTokenText()+" ";break;case a.SyntaxKind.PlusToken:case a.SyntaxKind.PlusPlusToken:if((g===a.SyntaxKind.PlusToken)||(g===a.SyntaxKind.PlusPlusToken)){c+=" ";}c+=s.getTokenText();break;case a.SyntaxKind.MinusToken:case a.SyntaxKind.MinusMinusToken:if((g===a.SyntaxKind.MinusToken)||(g===a.SyntaxKind.MinusMinusToken)){c+=" ";}c+=s.getTokenText();break;default:c+=s.getTokenText();break;}}if(!k){g=q;}}this.fb=c.length;this.gb=new Date().getTime()-this.gb;if(this.l.diagnostics)this.Bb();return c;};I.prototype.visitNode=function(b){if(this.Ab(b)){_super.prototype.visitNode.call(this,b);this.zb();}else{switch(b.kind){case a.SyntaxKind.Identifier:n.r("Identifier node walked in container id: ",this.yb().f());var c=this.yb();var d=b;var e=this.k.getSymbolAtLocation(d);if(!e){e=this.lb(d);}if(e){var g=Ast.v(e);if(g===undefined){if(e.flags&a.SymbolFlags.Transient){n.x("Ignoring transient symbol: ",e.name);break;}else{g=a.getSymbolId(e).toString();n.x("Generated symbol id for: ",e.name,g);}}if(Utils.m(this.bb,g)){n.r("Identifier already added: ",e.name,g);var h=this.bb[g];this.bb[g].M(d,this.yb());if(!Utils.m(this.yb().H,g)){this.yb().O[g]=h;}}else{var i=new D(d,e,this.yb());n.r("Adding new identifier: ",i.I(),i.J());this.yb().H[g]=i;this.bb[g]=i;var j=e.getName();if(j.length===1){i.A=j;this.yb().O[g]=i;}this.ib++;}}else{n.u("Identifier does not have a symbol: ",d.text);}break;}_super.prototype.visitNode.call(this,b);}};I.prototype.lb=function(b){var c=this.yb().W();if(c.kind===a.SyntaxKind.FunctionExpression){if(Ast.f(c.parent)){var d=c.parent.left.expression.expression;var e=this.k.getSymbolAtLocation(d);if(e&&e.members){if(e.members.has[b.text]){n.r("Symbol obtained from prototype function: ",b.text);return e.members[b.text];}}}}return undefined;};I.prototype.mb=function(b){this.hb=new Date().getTime();this.walk(b);this.nb();this.hb=new Date().getTime()-this.hb;if(this.l.diagnostics)this.Cb();return b;};I.prototype.nb=function(){for(var b in this.$){var c=this.$[b];var d=[];var e=[];var g=[];var h=Ast.z(c.W());if(h){d=Ast.s(h,this.k);}var i=Ast.y(c.W());if(i){g=Ast.t(i,this.k);}e=Ast.q(c.W(),this.k);var j=e.concat(d,g);n.x("Class excluded properties for: ",c.W().name.text,j.length,c.f());c.Q=j;}this.ob(this.cb);};I.prototype.ob=function(b){var c=b.ab();if(c){var g=this.$[c.name];if(g){var h=g.X();if(h){this.ub(h,g);b.Q=b.Q.concat(g.Q);}}}this.vb(b);var d=b.X();if(d){this.ub(d,b);}var e=b.Y();if(e){this.tb(e,b);}for(var i in b.H){var k=b.H[i];this.pb(k,b);}for(var l in b.N){var m=b.N[l];var n=Ast.v(m);var o=this.bb[n];this.pb(o,b);}var f=b.T();for(var j=0;j<f.length;j++){this.ob(f[j]);}};I.prototype.pb=function(a,b){var _this=this;if(this.qb(a)){var e_3=this.rb(b,a);n.x("Identifier shortened: ",a.I(),e_3);var f=a.K();for(var g in f){var h=f[g];h.G[e_3]=true;}Utils.d(a.L(),function(c){_this.sb(c,e_3);});return;}};I.prototype.qb=function(a){if(a.P()||a.O()||a.R()||a.S()||a.U()||a.V()||a.T(this.F.package.e())||a.Q()||a.N()){n.x("Identifier CAN be shortened: ",a.I());return true;}n.x("Identifier CANNOT be shortened: ",a.I());return false;};I.prototype.rb=function(b,d){if(!d.A){var e=d.I();if(e.length===1){d.A=e;}else{while(true){var f=this.db.c(b.V());Debug.a(f.length<=e.length);if(!Utils.m(b.G,f)){d.A=f;break;}else{n.x("Generated name was excluded: ",f,e);}}this.jb++;}}else{n.x("Identifier already has shortened name: ",d.I(),d.A);}n.r("Identifier shortened name: ",d.I(),d.A);return d.A;};I.prototype.sb=function(c,f){var g=c.text.length;var h=(c.end-c.pos);var j=c.getLeadingTriviaWidth();for(var k=c.pos+j;k<c.pos+h;k++){if(this.b.text[k]===c.text[0])break;}c.text=f;c.end=k+f.length;for(var i=0;i<g;i++){var l=" ";if(i<f.length){l=f[i];}this.b.text=Utils.G(this.b.text,k+i,l);}};I.prototype.tb=function(b,c){var _this=this;b.forEach(function(a){var b=Ast.v(a.declarations[0].symbol);if(b){var d=_this.bb[b];_this.pb(d,c);}else{n.u("Container local does not have a UId");}});};I.prototype.ub=function(b,c){for(var d in b){var e=b[d];var f=e.symbol;if(f){var g=Ast.v(f);if(g){var h=this.bb[g];var i=false;for(var j in c.Q){var k=h.B();var l=c.Q[j];if(k.name===l.name){i=true;h.A=h.I();break;}}if(!i){this.pb(h,c);}}else{n.u("Container member does not have a UId");}}else{n.u("Container member does not have a symbol.");}}};I.prototype.vb=function(b){var c=b.ab();if(c){var d=this.$[c.name];if(d){var e=d.X();if(e){for(var f in e){var g=e[f];var h=g.symbol;var i=Ast.v(h);var j=this.bb[i];if(j&&j.A){b.G[j.A]=true;}}}}}for(var k in b.H){var l=b.H[k];this.xb(l,b);}for(var m in b.N){var n=b.N[m];var o=Ast.v(n);var p=this.bb[o];Debug.a(p!==undefined,"Container classifiable identifier symbol not found.");this.xb(p,b);}};I.prototype.wb=function(b){var c=this.l.target;var e={};function f(b){var d=b.T();for(var i=0;i<d.length;i++){var g=d[i];f(g);}for(var h in b.O){var j=b.O[h];if((!j.P)||(c===a.ScriptTarget.ES5)){if(!Utils.m(e,j.J())){e[j.J()]=j;}}}}f(b.U());return e;};I.prototype.xb=function(a,b){var c=a.K();for(var d in c){var e=c[d];var f=this.wb(e);for(var g in f){var h=f[g];if(h.A){b.G[h.A]=true;}}}};I.prototype.yb=function(){return this.Z[this.Z.length-1];};I.prototype.zb=function(){return this.Z.pop();};I.prototype.Ab=function(b){var c=Ast.w(b);if(c&(1|2)){var d=new E(b,c,this.yb());var e=b.symbol;if(e&&(e.flags&a.SymbolFlags.Class)){var h=Ast.v(e);if(!Utils.m(this.yb().N,h)){this.yb().N[h]=e;}if(!Utils.m(this.$,e.name)){this.$[e.name]=d;}var i=Ast.z(b);if(i){var j=this.k.getSymbolAtLocation(i.types[0].expression);d._(j);}}var g=this.yb();if(!g){this.cb=d;}else{g.S(d);}this.Z.push(d);n.r("Next container id: ",d.f(),d.U().f());return true;}return false;};I.prototype.Bb=function(){var a=new r();a.e("Whitespace time",this.gb);a.f("Whitespace reduction",((this.eb-this.fb)/this.eb)*100.00);};I.prototype.Cb=function(){var a=new r();a.e("Minify time",this.hb);a.d("Total identifiers",this.ib);a.d("Identifiers shortened",this.jb);};return I;}(G));var J=(function(){function J(){}J.c=function(e){if(!e){return;}for(var i=0;i<e.length;i++){this.e(e[i]);}};J.e=function(c){if(!c){return;}var d="";if(c.file){var g=a.getLineAndCharacterOfPosition(c.file,c.start);d+=b.gray(c.file.fileName+"("+(g.line+1)+","+(g.character+1)+"): ");}var f;switch(c.category){case a.DiagnosticCategory.Error:f=b.red(a.DiagnosticCategory[c.category].toLowerCase());break;case a.DiagnosticCategory.Warning:f=b.yellow(a.DiagnosticCategory[c.category].toLowerCase());break;default:f=b.green(a.DiagnosticCategory[c.category].toLowerCase());}d+=f+" TS"+b.white(c.code+'')+": "+b.grey(a.flattenDiagnosticMessageText(c.messageText,"\n"));n.p(d);};return J;}());var K=(function(){function K(e,h,l){this.j=e;this.C(l);this.o=h;}K.prototype.v=function(){this.o.compilerOptions.watch||false;};K.prototype.x=function(){return this.m;};K.prototype.C=function(b){if(this.m){var c_3=b?b.getSourceFiles():undefined;Utils.d(this.m.getSourceFiles(),function(a){if(!(c_3&&Utils.g(c_3,a))){var b=a;if(b.fileWatcher){b.fileWatcher.unwatch(b.fileName);}}});}this.j.y(b);this.m=b;};return K;}());var L=(function(){function L(b,c){this.D=0;this.E=0;this.F=0;this.G=0;this.H="";this.I="";this.N={};this.O={};this.Q={};this.u=b;this.A=c;}L.prototype.R=function(z){var _this=this;this.q=z;this.G=new Date().getTime();var F=new C(this.u,this.A);var K=h.dirname(z.name);if(z.config.outDir){K=h.join(K,z.config.outDir);}var S=h.join(K,h.basename(z.name));S=TsCore.v(S);this.H="";this.I="";this.N={};this.O={};this.Q={};var T=false;var U={};var _loop_1=function(){var Z=z.fileNames[Y];n.r(">>> Processing bundle file:",Z);var _=this_1.u.getCanonicalFileName(TsCore.v(Z));n.r("BundleSourceFileName:",_);var ab=this_1.A.getSourceFile(_);if(!ab){var db=TsCore.l({code:6060,category:a.DiagnosticCategory.Error,key:"Bundle_source_file_0_not_found_6060",message:"Bundle source file '{0}' not found."},_);return {value:new B(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,[db])};}if(ab.languageVariant==a.LanguageVariant.JSX){T=true;}var bb=new Date().getTime();var cb=F.o(ab);this_1.D+=new Date().getTime()-bb;for(var eb in cb){if(!Utils.m(U,eb)){U[eb]=cb[eb];}}bb=new Date().getTime();n.r("Traversing module dependencies for bundle: ",ab.fileName);for(var fb in cb){n.r("Walking dependency nodes for module: ",fb);gb=cb[fb];gb.forEach(function(b){var c=_this.cb(b);var d=TsCore.j(c);if(d&&!d.isDeclarationFile){var e=_this.u.getCanonicalFileName(d.fileName);var f=cb[e];if(f){_this.S(b,f);}if(!Utils.m(_this.N,e)){_this.$(d);}}else{if(b.kind===a.SyntaxKind.ImportEqualsDeclaration){var g=b.name.text;var h=_this.U(b);if(_this.V(h,g)){_this.Z(b.getText());}}else{if(b.kind===a.SyntaxKind.ImportDeclaration){_this.W(b);}}}});}this_1.$(ab);this_1.E+=new Date().getTime()-bb;};var this_1=this,gb;for(var Y in z.fileNames){var state_1=_loop_1();if(typeof state_1==="object")return state_1.value;}var V=this.I;if(z.config.package.d()===1){V+="export namespace "+z.config.package.e()+" {\r\n";V+=this.H;V+=" \r\n}";}else{V+=this.H;}var W=T?".tsx":".ts";var X={path:S+W,extension:W,text:V};this.G=new Date().getTime()-this.G;if(this.A.getCompilerOptions().diagnostics){this.eb();}return new B(a.ExitStatus.Success,undefined,X);};L.prototype.S=function(b,c){for(var _i=0,c_4=c;_i<c_4.length;_i++){var d=c_4[_i];var e=this.cb(d);var f=TsCore.j(e);if(f&&!f.isDeclarationFile){var g=this.u.getCanonicalFileName(f.fileName);var h=this.db(d);if(h&&this.T(b,h)){if(!Utils.m(this.N,g)){this.$(f);}}}}};L.prototype.T=function(b,c){var d=this.cb(b);var e=(a.TypeFlags.Any|a.TypeFlags.String|a.TypeFlags.Number|a.TypeFlags.Boolean|a.TypeFlags.BooleanLiteral|a.TypeFlags.ESSymbol|a.TypeFlags.Void|a.TypeFlags.Undefined|a.TypeFlags.Null|a.TypeFlags.Never|a.TypeFlags.NonPrimitive);var f=this.A.getTypeChecker();var g=f.getExportsOfModule(d);for(var _i=0,g_2=g;_i<g_2.length;_i++){var h=g_2[_i];var i=f.getDeclaredTypeOfSymbol(h);if(i.flags&e){continue;}var j=f.getBaseTypes(i);for(var _a=0,j_2=j;_a<j_2.length;_a++){var k=j_2[_a];var l=k.symbol.getName();if(c.indexOf(l)>=0){n.r("Base class inheritance found",l);return true;}}}return false;};L.prototype.U=function(b){if(b.moduleReference.kind===a.SyntaxKind.ExternalModuleReference){var c=b.moduleReference;return c.expression.text;}else{return b.moduleReference.getText();}};L.prototype.V=function(a,b){if(!Utils.m(this.O,a)){this.O[a]={};}var c=this.O[a];if(!Utils.m(c,b)){c[b]=b;return true;}return false;};L.prototype.W=function(b){var _this=this;if(!b.importClause){return;}var c=b.moduleSpecifier.text;var e="import ";var f=false;var g=false;if(b.importClause){if(b.importClause.name&&this.V(c,b.importClause.name.text)){e+=b.importClause.name.text;f=true;}}if(b.importClause.namedBindings){if(b.importClause.namedBindings.kind===a.SyntaxKind.NamespaceImport){if(this.V(c,b.importClause.namedBindings.name.text)){if(f){e+=", ";}e+="* as ";e+=b.importClause.namedBindings.name.text;g=true;}}else{if(f){e+=", ";}e+="{ ";Utils.d(b.importClause.namedBindings.elements,function(a){if(_this.V(c,a.name.text)){if(!g){g=true;}else{e+=", ";}var b=a.propertyName;if(b){e+=b.text+" as "+a.name.text;}else{e+=a.name.text;}}});e+=" }";}}e+=" from ";e+=b.moduleSpecifier.getText();e+=";";if(f||g){this.Z(e);}};L.prototype.X=function(c){var _this=this;n.r("Processing import statements and export declarations in file: ",c.fileName);var f=c.text;a.forEachChild(c,function(c){if(c.kind===a.SyntaxKind.ImportDeclaration||c.kind===a.SyntaxKind.ImportEqualsDeclaration||c.kind===a.SyntaxKind.ExportDeclaration){n.r("processImportStatements() found import");var g=TsCore.k(c);if(g&&g.kind===a.SyntaxKind.StringLiteral){var h=_this.A.getTypeChecker().getSymbolAtLocation(g);if((h)&&(_this.ab(h)||_this.bb)){n.r("processImportStatements() removing code module symbol.");f=_this.Y(c.pos,c.end,f);}}}else{if(_this.q.config.package.d()===2){if(c.kind===a.SyntaxKind.ModuleDeclaration){var i_1=c;if(i_1.name.getText()!==_this.q.config.package.e()){if(Ast.b(i_1)&a.ModifierFlags.Export){n.r("Component namespace not package namespace. Removing export modifier.");var j=i_1.modifiers[0];f=_this.Y(j.pos,j.end,f);}}}else{if(Ast.b(c)&a.ModifierFlags.Export){var l=c.modifiers[0];f=_this.Y(l.pos,l.end,f);}}}}});return f;};L.prototype.Y=function(a,b,c){var d=b-a;var e="";for(var i=0;i<d;i++){e+=" ";}var f=c.substring(0,a);var g=c.substring(b);return f+e+g;};L.prototype.Z=function(a){n.r("Entering emitModuleImportDeclaration()");this.I+=a+"\n";};L.prototype.$=function(b){n.r("Entering addSourceFile() with: ",b.fileName);if(this._(b)){var c=this.X(b);this.H+=c+"\n";var d=this.u.getCanonicalFileName(b.fileName);this.N[d]=d;}else{if(!Utils.m(this.Q,b.fileName)){n.r("Adding definition file to bundle source context: ",b.fileName);this.Q[b.fileName]=b.text;}}};L.prototype._=function(b){return (b.kind===a.SyntaxKind.SourceFile&&!b.isDeclarationFile);};L.prototype.ab=function(b){var c=b.getDeclarations()[0];return ((c.kind===a.SyntaxKind.SourceFile)&&!(c.isDeclarationFile));};L.prototype.bb=function(b){var c=b.getDeclarations();if(c&&c.length>0){var d=b.getDeclarations()[0];if(d.kind===a.SyntaxKind.ModuleDeclaration){if(d.modifiers){for(var _i=0,_a=d.modifiers;_i<_a.length;_i++){var e=_a[_i];if(e.kind===a.SyntaxKind.DeclareKeyword){return true;}}}}}return false;};L.prototype.cb=function(b){var c=TsCore.k(b);if(c&&c.kind===a.SyntaxKind.StringLiteral){return this.A.getTypeChecker().getSymbolAtLocation(c);}};L.prototype.db=function(b){var c=[];var d=b.importClause.namedBindings;if(d){switch(d.kind){case a.SyntaxKind.NamespaceImport:break;case a.SyntaxKind.NamedImports:for(var _i=0,_a=d.elements;_i<_a.length;_i++){var e=_a[_i];c.push(e.getText());}break;}}return c;};L.prototype.eb=function(){var a=new r();a.e("Deps gen time",this.D);a.e("Deps walk time",this.E);a.e("Source gen time",this.G);};return L;}());var M=(function(){function M(b,c,d){this.E=0;this.F=0;this.G=0;this.H={};this.l=b;this.u=c;this.A=d;this.D=this.u.getCompilerOptions();}M.prototype.K=function(q,z){var _this=this;n.p("Compiling bundle...");this.F=this.G=new Date().getTime();var O;var Q;var S;var T=[];Utils.d(this.u.getSourceFiles(),function(a){T.push(a.fileName);});var U={};var V;var W=z.minify||false;if(W){var hb_1=h.dirname(q.path);var ib_1=h.basename(q.path,q.extension);O=TsCore.v(h.join(hb_1,ib_1+".min.ts"));}else{O=q.path;}Q=q.text;this.H[O]=Q;S=a.createSourceFile(O,q.text,this.D.target);T.push(O);Utils.d(this.u.getSourceFiles(),function(a){_this.H[a.fileName]=a.text;});function g(b,c,e,f){U[b]=c;}function i(b,c,e){if(b===O){return S;}var f=V(b,c,e);return f;}V=this.l.getSourceFile;this.l.getSourceFile=i;this.l.writeFile=g;var X=this.D;X.declaration=z.declaration||this.D.declaration;X.sourceMap=z.sourceMap||this.D.sourceMap;X.noEmit=false;if(W){X.declaration=false;X.removeComments=true;}var Y=a.createProgram(T,X,this.l);var Z=a.getPreEmitDiagnostics(Y);this.G=new Date().getTime()-this.G;if(this.D.noEmitOnError&&Z.length>0){return new o(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,Z);}if(W){n.p("Minifying bundle...");var jb=new I(Y,X,z);S=jb.transform(S);}this.E=new Date().getTime();var $=Y.emit(S);this.E=new Date().getTime()-this.E;n.r("Streaming vinyl bundle source: ",O);var _=new t({path:O,contents:new Buffer(S.text)});this.A.push(_);var ab=Z.concat($.diagnostics);if($.emitSkipped){return new o(a.ExitStatus.DiagnosticsPresent_OutputsSkipped,ab);}if(this.D.noEmitOnError&&ab.length>0){return new o(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,ab);}var bb=h.dirname(q.path);var cb=h.basename(q.path,q.extension);var db=W?".min":"";var eb=TsCore.v(h.join(bb,cb+db+".js"));if(Utils.m(U,eb)){var lb=U[eb];if(W){var nb=new I(Y,X,z);lb=nb.kb(lb);}n.r("Streaming vinyl js: ",cb);var mb=new t({path:eb,contents:new Buffer(lb)});this.A.push(mb);}var fb=TsCore.v(h.join(bb,cb+db+".d.ts"));if(Utils.m(U,fb)){n.r("Streaming vinyl d.ts: ",fb);var ob=new t({path:fb,contents:new Buffer(U[fb])});this.A.push(ob);}var gb=TsCore.v(h.join(bb,cb+db+".js.map"));if(Utils.m(U,gb)){n.r("Streaming vinyl js.map: ",gb);var pb=new t({path:gb,contents:new Buffer(U[gb])});this.A.push(pb);}this.F=new Date().getTime()-this.F;if(this.D.diagnostics)this.N();if(ab.length>0){return new o(a.ExitStatus.DiagnosticsPresent_OutputsGenerated,ab);}else{return new o(a.ExitStatus.Success);}};M.prototype.N=function(){var a=new r();a.e("Pre-emit time",this.G);a.e("Emit time",this.E);a.e("Compile time",this.F);};return M;}());var N=(function(){function N(a,b){var _this=this;this.G=0;this.H=0;this.I=0;this.O=0;this.$=function(a,b){_this.Q=undefined;_this.bb();};this.ab=function(a,b,c){a.fileWatcher.unwatch(a.fileName);a.fileWatcher=undefined;_this.bb();};this.cb=function(){_this.T=undefined;var a=_this.Y();_this.hb(a);if(_this.Q.o.compilerOptions.watch){n.p("Watching for project changes...");}};this.m=a;this.u=b;}N.prototype.U=function(A){var S=this.Z();if(!S.success){J.c(S.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.Q=this.V(S);n.p("Building Project with: "+b.magenta(""+this.E));n.p("TypeScript compiler version: ",a.version);this.v=A;var W=this.Y();this.hb(W);if(S.compilerOptions.watch){n.p("Watching for project changes...");}else{this.X();}return W;};N.prototype.V=function(N){if(N.compilerOptions.watch){if(!this.W()){N.compilerOptions.watch=false;}}var U=new z(N.compilerOptions,this.ab);return new K(U,N);};N.prototype.W=function(){var _this=this;if(!a.sys.watchFile){var b=TsCore.l({code:5001,category:a.DiagnosticCategory.Warning,key:"The_current_node_host_does_not_support_the_0_option_5001",message:"The current node host does not support the '{0}' option."},"-watch");J.e(b);return false;}if(!this.S){this.S=d.watch(this.E);this.S.on("change",function(U,jb){return _this.$(U,jb);});}return true;};N.prototype.X=function(){this.v.push(null);};N.prototype.Y=function(){this.G=this.I=new Date().getTime();if(!this.Q){var E=this.Z();if(!E.success){J.c(E.errors);return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}this.Q=this.V(E);}var e=[];var h=this.Q.o.fileNames;var l=this.Q.o.bundles;var m=this.Q.o.compilerOptions;var q=a.createProgram(h,m,this.Q.j,this.Q.x());this.I=new Date().getTime()-this.I;this.Q.C(q);var r=new y(this.Q.j,q,this.v);this.H=new Date().getTime();var u=r.P();this.H=new Date().getTime()-this.H;if(!u.k()){J.c(u.f());return u.g();}if(m.listFiles){Utils.d(this.Q.x().getSourceFiles(),function(a){n.p(a.fileName);});}this.O=new Date().getTime();var z=new L(this.Q.j,this.Q.x());var A=new M(this.Q.j,this.Q.x(),this.v);var D;for(var i=0,F=l.length;i<F;i++){n.p("Building bundle: ",b.cyan(l[i].name));D=z.R(l[i]);if(!D.w()){J.c(D.t());return a.ExitStatus.DiagnosticsPresent_OutputsSkipped;}u=A.K(D.s(),l[i].config);if(!u.k()){J.c(u.f());return u.g();}}this.O=new Date().getTime()-this.O;this.G=new Date().getTime()-this.G;if(m.diagnostics){this.ib();}if(e.length>0){return a.ExitStatus.DiagnosticsPresent_OutputsGenerated;}return a.ExitStatus.Success;};N.prototype.Z=function(){var _this=this;try{var q=c.lstatSync(this.m).isDirectory();}catch(e){var s=TsCore.l({code:6064,category:a.DiagnosticCategory.Error,key:"Cannot_read_project_path_0_6064",message:"Cannot read project path '{0}'."},this.m);return {success:false,errors:[s]};}if(q){this.D=this.m;this.E=h.join(this.m,"tsconfig.json");}else{this.D=h.dirname(this.m);this.E=this.m;}n.r("Reading config file:",this.E);var f=a.readConfigFile(this.E,this.db);if(f.error){return {success:false,errors:[f.error]};}var g=f.config;n.r("Parsing config file...");var i=a.parseJsonConfigFileContent(g,a.sys,this.D);if(i.errors.length>0){return {success:false,errors:i.errors};}i.fileNames=this.fb(i.fileNames,this.D);if(this.u.convertFiles===true){this.gb(i.fileNames,this.D);}var j=new w();var k=j.b(g,this.D);if(k.errors.length>0){return {success:false,errors:k.errors};}k.bundles.forEach(function(a){a.fileNames=_this.fb(a.fileNames,_this.D);});var o=this.eb(this.u,this.D);if(o.errors.length>0){return {success:false,errors:o.errors};}var p=Utils.F(o.options,i.options);n.r("Compiler options: ",p);return {success:true,compilerOptions:p,fileNames:i.fileNames,bundles:k.bundles};};N.prototype.bb=function(){if(this.T){clearTimeout(this.T);}this.T=setTimeout(this.cb,250);};N.prototype.db=function(b){return a.sys.readFile(b);};N.prototype.eb=function(b,c){var d=a.parseJsonConfigFileContent(b,a.sys,c);if(d.options.project){var e=TsCore.l({code:5099,category:a.DiagnosticCategory.Error,key:"The_compiler_option_0_is_not_supported_in_this_context_5099",message:"The compiler option '{0}' is not supported in this context."},"--project");d.errors.push(e);}return d;};N.prototype.fb=function(c,e){var f=new A();var g=[];Utils.d(c,function(b){if(!f.a(b)){g.push(h.normalize(b));}});var i=f.b(c,e);var j=[];Utils.d(i,function(a){j.push(h.normalize(a));});return _.union(j,g);};N.prototype.gb=function(a,d){var f="";try{f=c.readFileSync(this.E,'utf8');if(f!==undefined){var g=JSON.parse(f);var i_2=[];a.forEach(function(a){i_2.push(h.relative(d,a).replace(/\\/g,"/"));});g["files"]=i_2;c.writeFileSync(this.E,JSON.stringify(g,undefined,4));}}catch(e){n.p(b.yellow("Converting project files failed."));}};N.prototype.hb=function(c){switch(c){case a.ExitStatus.Success:n.p(b.green("Project build completed successfully."));break;case a.ExitStatus.DiagnosticsPresent_OutputsSkipped:n.p(b.red("Build completed with errors."));break;case a.ExitStatus.DiagnosticsPresent_OutputsGenerated:n.p(b.red("Build completed with errors. "+b.italic("Outputs generated.")));break;}};N.prototype.ib=function(){var b=new r();b.a("Total build times...");b.e("Pre-build time",this.I);b.e("Compiling time",this.H);b.e("Bundling time",this.O);b.e("Build time",this.G);};return N;}());var TsProject;(function(TsProject){function src(a,b){if(a===undefined&&typeof a!=='string'){throw new Error("Provide a valid directory or file path to the Typescript project configuration json file.");}b=b||{};b.logLevel=b.logLevel||0;n.j(b.logLevel);n.l("TsProject");var c=new q();var d=new N(a,b);d.U(c);return c;}TsProject.src=src;})(TsProject=exports.TsProject||(exports.TsProject={}));module.exports=TsProject;